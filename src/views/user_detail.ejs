<% layout('_layout') -%>
<section class="container">
  <h3 class="center-align">Información del usuario</h3>
  <div class="card">
    <div class="card-content">
      <ul class="collection" id="info"></ul>
      <div class="section">
        <a href="/dashboard" class="btn grey">Volver al Dashboard</a>
      </div>
    </div>
  </div>
</section>

<script type="module">
  import { ensureAuthOrRedirect, fetchWithAuth } from '/js/app.js';

  ensureAuthOrRedirect();

  async function load() {
    const userId = location.pathname.split('/').pop();
    try {
      const res = await fetchWithAuth(`/api/users/${userId}`);
      if (!res.ok) {
        M.toast({html:'No se pudo obtener la info', classes:'red'});
        return;
      }
      const u = await res.json();
      document.getElementById('info').innerHTML = `
        <li class="collection-item"><b>Nombre:</b> ${u.name} ${u.lastName ?? ''}</li>
        <li class="collection-item"><b>Email:</b> ${u.email}</li>
        <li class="collection-item"><b>Teléfono:</b> ${u.phoneNumber ?? ''}</li>
        <li class="collection-item"><b>Roles:</b> ${(u.roles || []).join(', ')}</li>
        <li class="collection-item"><b>Dirección:</b> ${u.adress ?? ''}</li>
        <li class="collection-item"><b>Fecha de registro:</b> ${new Date(u.createdAt).toLocaleDateString()}</li>
      `;
    } catch (err) {
      console.error(err);
      M.toast({html:'Error al cargar datos', classes:'red'});
    }
  }

  load();
</script>
