<!-- views/dashboard_user.ejs (REEMPLAZA SOLO EL <script>) -->
<script type="module">
  import { ensureAuthOrRedirect, getMe } from '/js/app.js';
  ensureAuthOrRedirect();

  async function load() {
    const me = await getMe();
    const roles = Array.isArray(me.roles)
      ? me.roles.map(r => (typeof r === 'string' ? r : r.name))
      : [];
    if (!roles.includes('user')) {
      location.href = '/403';
      return;
    }
    // ok
  }
  load();
</script>
